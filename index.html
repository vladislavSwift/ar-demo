<!DOCTYPE html>
<html>
  <head>
    <title>AR Walking Portal</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    
    <!-- EXTRA SCRIPT: This fixes the "Invisible from inside" bug -->
    <script>
      AFRAME.registerComponent('fix-material', {
        init: function () {
          this.el.addEventListener('model-loaded', () => {
            const mesh = this.el.getObject3D('mesh');
            if (!mesh) return;
            mesh.traverse((node) => {
              if (node.isMesh) {
                // This forces the walls to be visible from BOTH sides
                node.material.side = THREE.DoubleSide; 
                // This ensures the materials don't look too dark
                node.material.needsUpdate = true;
              }
            });
          });
        }
      });
    </script>
  </head>

  <body>
    <!-- 
      We enable AR mode. 
      'referenceSpaceType: local-floor' is REQUIRED for walking on Android/WebXR 
    -->
    <a-scene 
      xr-mode-ui="enabled: true"
      webxr="optionalFeatures: hit-test, local-floor; referenceSpaceType: local-floor"
      renderer="colorManagement: true; physicallyCorrectLights: true;">
      
      <a-assets>
        <!-- IMPORTANT: Make sure your file is named exactly 'model.glb' (lowercase) -->
        <a-asset-item id="portal-model" src="./model.glb"></a-asset-item>
      </a-assets>

      <!-- LIGHTING: Essential so the screen isn't black -->
      <a-light type="ambient" intensity="1.5" color="#ffffff"></a-light>
      <a-light type="directional" intensity="1" position="-1 1 0"></a-light>

      <!-- 
        TEST BOX: 
        If you see this Red Box but NOT your model, 
        it means your .GLB file path is wrong.
      -->
      <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9" width="0.5" height="0.5" depth="0.5"></a-box>

      <!-- THE CAMERA RIG -->
      <a-entity id="rig" position="0 0 0">
        <a-entity camera look-controls wasd-controls position="0 1.6 0"></a-entity>
      </a-entity>

      <!-- YOUR MODEL -->
      <!-- 
         We added 'fix-material' to handle the visibility.
         Adjust scale if you feel too huge or too small.
      -->
      <a-gltf-model 
        src="#portal-model" 
        position="0 0 0" 
        scale="10 10 10"
        fix-material>
      </a-gltf-model>

    </a-scene>
  </body>
</html>